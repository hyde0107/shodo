<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>データエディタ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="page-wrapper">
        <h1>歌詞データ エディタ</h1>
        <div class="admin-box">
            <h3>1. 歌詞を貼り付け (00:00 歌詞)</h3>
            <textarea id="rawInput"></textarea>
            <button class="btn" onclick="importText()">表に反映する</button>

            <table class="admin-table">
                <thead>
                    <tr><th>時間</th><th>歌詞</th><th>メモ</th><th>削除</th></tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>

            <div style="margin-top:20px; display:flex; gap:10px;">
                <button class="btn" onclick="addRow()">＋ 行を追加</button>
                <button class="btn btn-red" onclick="generateCode()">コードを生成</button>
            </div>
            <div id="output"></div>
        </div>
        <a href="index.html" class="btn back-link">← 戻る</a>
    </div>

    <script>
        function addRow(time = "", text = "", memo = "") {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><input type="text" class="t-time" value="${time}" placeholder="00:00"></td>
                <td><input type="text" class="t-text" value="${text}"></td>
                <td><input type="text" class="t-memo" value="${memo}" placeholder="例: 大字、名前"></td>
                <td><button class="delete-btn" onclick="this.parentElement.parentElement.remove()">×</button></td>
            `;
            document.getElementById('tableBody').appendChild(tr);
        }

        // インポート時、既存の表をクリアするか選べると便利なので少し強化
        function importText() {
            const input = document.getElementById('rawInput').value.trim();
            if (!input) return;
            
            const lines = input.split('\n');
            lines.forEach(line => {
                const match = line.match(/(\d{1,2}:\d{2})[\s　]+(.*)/);
                if (match) addRow(match[1], match[2], "");
            });
            document.getElementById('rawInput').value = "";
        }

        function generateCode() {
            const rows = document.querySelectorAll('#tableBody tr');
            if (rows.length === 0) return;

            let dataLines = [];
            rows.forEach(row => {
                const time = row.querySelector('.t-time').value.trim();
                const text = row.querySelector('.t-text').value.trim();
                const memo = row.querySelector('.t-memo').value.trim();
                if (time || text) {
                    dataLines.push(`  ["${time}", "${text}", "${memo}"]`);
                }
            });

            const code = "const myData = [\n" + dataLines.join(",\n") + "\n];";
            const out = document.getElementById('output');
            out.textContent = code;
            out.style.display = "block";

            // クリップボードに自動コピー（追加機能）
            navigator.clipboard.writeText(code).then(() => {
                alert("コードを生成し、クリップボードにコピーしました！\nそのままdata.jsに貼り付けられます。");
            });
        }
    </script>
</body>
</html>
