<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>一括変換ツール</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="page-wrapper">
        <h1>一括変換ツール</h1>
        <div class="admin-box">
            <p>SRTファイルや歌詞テキストを貼り付けてください</p>
            <textarea id="inputText" placeholder="01:20 歌詞のように入力"></textarea>
            <button class="btn btn-red" style="width:100%" onclick="convert()">コードを生成する</button>
            <pre id="result"></pre>
        </div>
        <a href="index.html" class="btn back-link">← 戻る</a>
    </div>

    <script>
        function convert() {
            const input = document.getElementById('inputText').value.trim();
            if (!input) return;
            let resultArray = [];

            if (input.includes('-->')) { // SRT形式
                const blocks = input.split(/\n\s*\n/);
                blocks.forEach(block => {
                    const lines = block.split('\n');
                    const timeMatch = block.match(/(\d{2}):(\d{2}):(\d{2})/);
                    if (timeMatch) {
                        const timeStr = `${timeMatch[2]}:${timeMatch[3]}`;
                        const text = lines.slice(2).join(' ').trim();
                        // ♪だけの行を除外
                        if (text && text !== '♪') resultArray.push(`  ["${timeStr}", "${text}", ""]`);
                    }
                });
            } else { // 自由形式 (01:20 歌詞)
                const lines = input.split('\n');
                lines.forEach(line => {
                    // 正規表現を少し強化：タブや複数のスペースにも対応
                    const match = line.match(/(\d{1,2}:\d{2})[\s　]+(.*)/);
                    if (match) resultArray.push(`  ["${match[1]}", "${match[2].trim()}", ""]`);
                });
            }

            const output = document.getElementById('result');
            const code = `const myData = [\n${resultArray.join(',\n')}\n];`;
            output.textContent = code;
            output.style.display = "block";

            // --- 追加機能：コピーボタンを自動生成 ---
            if (!document.getElementById('copy-btn')) {
                const copyBtn = document.createElement('button');
                copyBtn.id = 'copy-btn';
                copyBtn.className = 'btn';
                copyBtn.style.width = "100%";
                copyBtn.style.marginTop = "10px";
                copyBtn.innerText = "生成されたコードをコピー";
                copyBtn.onclick = () => {
                    navigator.clipboard.writeText(code);
                    copyBtn.innerText = "コピー完了！";
                    setTimeout(() => copyBtn.innerText = "生成されたコードをコピー", 2000);
                };
                output.parentNode.insertBefore(copyBtn, output.nextSibling);
            }
        }
    </script>
</body>
</html>
