<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>01 2026公民館大表示</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="monitor-body">

    <a href="index.html" id="back-to-menu">← メニューに戻る</a>

    <div id="start-overlay" onclick="startPerformance()">
        <div id="start-btn">読み込み中...</div>
    </div>

    <div id="monitor-container">
        <div id="lyrics-guide"></div>
        <span id="action-label">READY</span>
        <span id="name-label">...</span>
    </div>

    <div id="controls">
        <input type="range" id="seek-bar" value="0" step="1">
        <div class="btn-row">
            <button class="ctrl-btn" onclick="skip(-10)">-10秒</button>
            <button class="ctrl-btn" id="play-pause-btn" onclick="togglePlay()">PAUSE</button>
            <button class="ctrl-btn" onclick="skip(10)">+10秒</button>
        </div>
    </div>

    <button id="fs-btn" onclick="toggleFullScreen()">[ ] 全画面</button>
    
    <div id="player-wrapper"><div id="player"></div></div>

    <script src="01data.js"></script>
    <script src="script.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>

    <script>
        let player;
        const seekBar = document.getElementById('seek-bar');
        const sBtn = document.getElementById('start-btn');
        
        // script.jsの updateMonitorUI 関数に渡すための要素リスト
        const elements = {
            lyricsEl: document.getElementById('lyrics-guide'),
            actionEl: document.getElementById('action-label'),
            nameEl: document.getElementById('name-label'),
            container: document.getElementById('monitor-container')
        };

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                videoId: 'lN17WxlwdTY',
                playerVars: { 'autoplay': 0, 'controls': 0, 'rel': 0, 'playsinline': 1 },
                events: { 'onReady': onPlayerReady }
            });
        }

        function onPlayerReady() {
            seekBar.max = player.getDuration();
            sBtn.innerText = "練習を開始する";
            sBtn.classList.add('ready');

            // 共通ロジック(updateMonitorUI)を呼び出すループ
            setInterval(() => {
                const currentTime = player.getCurrentTime();
                seekBar.value = currentTime;
                
                // --- script.js にまとめた関数を呼び出すだけ！ ---
                updateMonitorUI(currentTime, myData, elements);
            }, 200);

            seekBar.addEventListener('input', () => player.seekTo(seekBar.value));
        }

        function startPerformance() {
            if(!sBtn.classList.contains('ready')) return;
            document.getElementById('start-overlay').style.display = 'none';
            player.playVideo();
        }

        function togglePlay() {
            const state = player.getPlayerState();
            if (state === 1) { // 再生中
                player.pauseVideo();
                document.getElementById('play-pause-btn').innerText = "PLAY";
            } else {
                player.playVideo();
                document.getElementById('play-pause-btn').innerText = "PAUSE";
            }
        }

        function skip(sec) {
            player.seekTo(player.getCurrentTime() + sec);
        }

        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
            }
        }
    </script>
</body>
</html>
