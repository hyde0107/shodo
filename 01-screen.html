<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>モニターPro - 現場用修正版</title>
    <link rel="stylesheet" href="style.css">
    
    <style>
        /* HTMLファイルに残すのは「配置」の微調整だけ */
        
        /* メインコンテンツ（残りのスペースを全て埋める） */
        #monitor-container {
            flex: 1; /* 余ったスペースを全て使う設定 */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            width: 100%;
            /* padding-bottom を削除してスクロールを回避 */
            overflow: hidden; /* はみ出た部分は隠す */
        }

        /* 歌詞ガイド */
        #lyrics-guide { 
            font-size: 2.5vw; /* 少し小さくして調整 */
            color: rgba(255,255,255,0.8) !important;
            margin-bottom: 3vh;
            min-height: 1.2em;
            font-weight: bold; 
        }

        /* アクション指示（READYなど） */
        #action-label { 
            font-size: 6vw; 
            font-weight: bold; 
            margin-bottom: 1vh; 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        /* 名前表示 */
        #name-label { 
            font-size: 16vw; 
            font-weight: 900; 
            line-height: 1.1; 
            white-space: pre-wrap; 
            text-shadow: 4px 4px 10px rgba(0,0,0,0.6);
        }

        /* 下部のコントロールバー（高さを固定） */
        #controls { 
            height: 15vh; /* 画面高さの15%に固定 */
            min-height: 100px; /* 最低でも100pxは確保 */
            width: 100%; 
            background: rgba(0,0,0,0.6); 
            border-top: 1px solid rgba(255,255,255,0.2); 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            z-index: 1500; 
            /* paddingを追加して操作しやすく */
            padding: 10px 0;
            box-sizing: border-box;
        }
        #seek-bar { width: 90%; cursor: pointer; height: 30px; margin-bottom: 10px;}
        .btn-row { display: flex; gap: 30px; width: 90%; justify-content: center; }
        .ctrl-btn { 
            flex: 1; /* ボタンを均等な幅にする */
            max-width: 150px;
            background: rgba(255,255,255,0.15); 
            border: 1px solid rgba(255,255,255,0.5); 
            color: #fff; 
            padding: 12px 0; /* タップしやすいように縦幅を増やす */
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 18px; 
            font-weight: bold;
        }
        .ctrl-btn:active { background: rgba(255,255,255,0.4); }

        /* プレーヤー非表示 */
        #player-wrapper { position: absolute; visibility: hidden; pointer-events: none; }
    </style>
</head>
<body class="monitor-body bg-black">

    <a href="index.html" id="back-to-index-btn">← TOPへ</a>

    <div id="start-overlay" onclick="startPerformance()">
        <div class="big-start-btn">
            練習を開始する
        </div>
    </div>

    <div id="monitor-container">
        <div id="lyrics-guide"></div>
        <span id="action-label">READY</span>
        <span id="name-label">...</span>
    </div>

    <div id="controls">
        <input type="range" id="seek-bar" value="0" step="1">
        <div class="btn-row">
            <button class="ctrl-btn" onclick="skip(-10)">-10秒</button>
            <button class="ctrl-btn" id="play-pause-btn" onclick="togglePlay()">PAUSE</button>
            <button class="ctrl-btn" onclick="skip(10)">+10秒</button>
        </div>
    </div>
    
    <div id="player-wrapper"><div id="player"></div></div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="script.js"></script>
    <script src="data01.js"></script>

    <script>
        // === JavaScriptは変更なし ===
        let player;
        const lyricsEl = document.getElementById('lyrics-guide');
        const actionEl = document.getElementById('action-label');
        const nameEl = document.getElementById('name-label');
        const seekBar = document.getElementById('seek-bar');
        const container = document.getElementById('monitor-container');

        const dataSec = performanceData.map(d => ({
            s: parseTime(d[0]), l: d[1], m: d[2]
        }));

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                videoId: 'lN17WxlwdTY',
                playerVars: { 'autoplay': 0, 'controls': 0, 'rel': 0, 'playsinline': 1 },
                events: { 'onReady': onPlayerReady }
            });
        }

        function onPlayerReady() {
            seekBar.max = player.getDuration();
            setInterval(updateMonitor, 200);
            seekBar.addEventListener('input', () => player.seekTo(seekBar.value));
        }

        function startPerformance() {
            // 開始時にオーバーレイを非表示にする
            document.getElementById('start-overlay').style.display = 'none';
            player.playVideo();
        }

        function togglePlay() {
            const state = player.getPlayerState();
            if (state === 1) {
                player.pauseVideo();
                document.getElementById('play-pause-btn').innerText = "PLAY";
            } else {
                player.playVideo();
                document.getElementById('play-pause-btn').innerText = "PAUSE";
            }
        }

        function skip(sec) {
            player.seekTo(player.getCurrentTime() + sec);
        }

        function updateMonitor() {
            const currentTime = player.getCurrentTime();
            seekBar.value = currentTime;
            
            let lastMemoIndex = -1;
            let currentLyrics = "";

            for (let i = 0; i < dataSec.length; i++) {
                if (currentTime >= dataSec[i].s) {
                    currentLyrics = dataSec[i].l;
                    if (dataSec[i].m && dataSec[i].m.trim() !== "") lastMemoIndex = i;
                } else break;
            }

            lyricsEl.innerText = currentLyrics || "";

            if (lastMemoIndex !== -1) {
                let memo = dataSec[lastMemoIndex].m;
                const info = getMemoInfo(memo);
                
                let parts = memo.split(/[、]/);
                let action = parts[0] || "";
                let names = (parts[1] || "").replace(/・/g, '\n');

                actionEl.innerText = action;
                nameEl.innerText = names;

                if (info.isPrep) container.classList.add('is-prep');
                else container.classList.remove('is-prep');

                document.body.className = "monitor-body " + info.bgClass;
            }
        }
    </script>
</body>
</html>
